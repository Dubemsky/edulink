{% extends "myapp/teachers/profile/base_profile.html" %}

{% block title %}My Profile | EduLink{% endblock %}

{% block profile_content %}
<!-- View Profile Section -->
<div id="viewProfileSection">
  <div class="profile-detail-header">
    <h3 class="profile-detail-title">Professional Information</h3>
    <button type="button" id="editProfileBtn" class="btn btn-primary">
      <i class="bi bi-pencil-square"></i> Edit Profile
    </button>
  </div>
  
  <div class="profile-section">
    <h4 class="section-title"><i class="bi bi-person"></i> Basic Details</h4>
    <div class="row">
      <div class="col-md-6 mb-3">
        <strong class="form-label">Full Name</strong>
        <p>{{ teacher.name|default:"Teacher Name" }}</p>
      </div>
      <div class="col-md-6 mb-3">
        <strong class="form-label">Email</strong>
        <p>{{ teacher.email|default:"teacher@example.com" }}</p>
      </div>
      <div class="col-md-6 mb-3">
        <strong class="form-label">Subject Area</strong>
        <p>{{ teacher.subject|default:"Mathematics" }}</p>
      </div>
      <div class="col-md-6 mb-3">
        <strong class="form-label">Experience</strong>
        <p>{{ teacher.years_experience|default:"5" }} years</p>
      </div>
      <div class="col-md-6 mb-3">
        <strong class="form-label">School/Institution</strong>
        <p>{{ teacher.school|default:"Edison High School" }}</p>
      </div>
      <div class="col-md-6 mb-3">
        <strong class="form-label">Joined On</strong>
        <p>{{ teacher.joined_date|date:"F d, Y"|default:"January 1, 2023" }}</p>
      </div>
    </div>
  </div>
  
  <div class="profile-section">
    <h4 class="section-title"><i class="bi bi-journal-text"></i> Professional Bio</h4>
    <p>{{ teacher.bio|default:"No professional bio has been added yet." }}</p>
  </div>
  
  <div class="profile-section">
    <h4 class="section-title"><i class="bi bi-mortarboard"></i> Education & Qualifications</h4>
    <ul class="qualifications-list">
      {% for qualification in teacher.qualifications %}
        <li class="qualification-item">
          <div class="qualification-degree">{{ qualification.degree }}</div>
          <div class="qualification-school">{{ qualification.institution }}</div>
          <div class="qualification-year">{{ qualification.year }}</div>
        </li>
      {% empty %}
        <li>No education or qualifications have been added yet.</li>
      {% endfor %}
    </ul>
  </div>
  
  <div class="profile-section">
    <h4 class="section-title"><i class="bi bi-link-45deg"></i> Professional Websites</h4>
    <ul class="website-list">
      {% for website in teacher.websites %}
        <li class="website-item">
          <a href="{{ website.url }}" target="_blank">{{ website.name|default:website.url }}</a>
        </li>
      {% empty %}
        <li class="website-item">
          <span>No websites have been added yet.</span>
        </li>
      {% endfor %}
    </ul>
  </div>
</div>

<!-- Edit Profile Section (Hidden by Default) -->
<div id="editProfileSection" style="display: none;">
  <div class="profile-detail-header">
    <h3 class="profile-detail-title">Edit Profile</h3>
  </div>

  <form id="profileEditForm" method="POST" action="{% url 'teacher_profile_page_my_profile' %}">
    {% csrf_token %}
    <input type="hidden" name="type" value="profile">
    
    <div class="profile-section">
      <h4 class="section-title"><i class="bi bi-person"></i> Basic Details</h4>
      <div class="row">
        <div class="col-md-6 form-row">
          <label class="form-label">Full Name</label>
          <input type="text" class="form-control" name="name" value="{{ teacher.name|default:'' }}" required>
        </div>
        <div class="col-md-6 form-row">
          <label class="form-label">Email</label>
          <input type="email" class="form-control" name="email" value="{{ teacher.email|default:'' }}" readonly>
          <small class="form-text">Email cannot be changed. Contact support for assistance.</small>
        </div>
        <div class="col-md-6 form-row">
          <label class="form-label">Subject Area</label>
          <input type="text" class="form-control" name="subject" value="{{ teacher.subject|default:'' }}">
        </div>
        <div class="col-md-6 form-row">
          <label class="form-label">Years of Experience</label>
          <input type="number" class="form-control" name="years_experience" value="{{ teacher.years_experience|default:'' }}" min="0" max="50">
        </div>
        <div class="col-md-6 form-row">
          <label class="form-label">School/Institution</label>
          <input type="text" class="form-control" name="school" value="{{ teacher.school|default:'' }}">
        </div>
      </div>
    </div>
    
    <div class="profile-section">
      <h4 class="section-title"><i class="bi bi-journal-text"></i> Professional Bio</h4>
      <div class="form-row">
        <textarea class="form-control" name="bio" rows="4" placeholder="Share your professional background, teaching philosophy, and expertise.">{{ teacher.bio|default:'' }}</textarea>
        <small class="form-text">Your bio will be visible to students and other teachers on the platform.</small>
      </div>
    </div>
    
    <div class="profile-section">
      <h4 class="section-title"><i class="bi bi-mortarboard"></i> Education & Qualifications</h4>
      <div id="qualificationsContainer">
        {% for qualification in teacher.qualifications %}
          <div class="qualification-input-group">
            <div class="row">
              <div class="col-md-5 form-row">
                <input type="text" class="form-control" name="qualification_degree[]" value="{{ qualification.degree }}" placeholder="Degree/Qualification">
              </div>
              <div class="col-md-5 form-row">
                <input type="text" class="form-control" name="qualification_institution[]" value="{{ qualification.institution }}" placeholder="Institution">
              </div>
              <div class="col-md-2 form-row">
                <div class="input-group">
                  <input type="number" class="form-control" name="qualification_year[]" value="{{ qualification.year }}" placeholder="Year">
                  <button type="button" class="btn btn-danger remove-qualification">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        {% empty %}
          <div class="qualification-input-group">
            <div class="row">
              <div class="col-md-5 form-row">
                <input type="text" class="form-control" name="qualification_degree[]" placeholder="Degree/Qualification">
              </div>
              <div class="col-md-5 form-row">
                <input type="text" class="form-control" name="qualification_institution[]" placeholder="Institution">
              </div>
              <div class="col-md-2 form-row">
                <div class="input-group">
                  <input type="number" class="form-control" name="qualification_year[]" placeholder="Year">
                  <button type="button" class="btn btn-danger remove-qualification">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
      <button type="button" class="btn btn-secondary mt-3" id="addQualificationBtn">
        <i class="bi bi-plus-circle"></i> Add Qualification
      </button>
    </div>
    
    <div class="profile-section">
      <h4 class="section-title"><i class="bi bi-link-45deg"></i> Professional Websites</h4>
      <div id="websitesContainer">
        {% for website in teacher.websites %}
          <div class="website-input-group">
            <input type="text" class="form-control" name="website_name[]" value="{{ website.name }}" placeholder="Website Name">
            <input type="url" class="form-control" name="website_url[]" value="{{ website.url }}" placeholder="https://example.com">
            <button type="button" class="btn btn-danger remove-website">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        {% empty %}
          <div class="website-input-group">
            <input type="text" class="form-control" name="website_name[]" placeholder="Website Name">
            <input type="url" class="form-control" name="website_url[]" placeholder="https://example.com">
            <button type="button" class="btn btn-danger remove-website">
              <i class="bi bi-trash"></i>
            </button>
          </div>
        {% endfor %}
      </div>
      <button type="button" class="btn btn-secondary mt-3" id="addWebsiteBtn">
        <i class="bi bi-plus-circle"></i> Add Website
      </button>
    </div>
    
    <div class="form-row text-end mt-4">
      <button type="button" class="btn btn-secondary me-2" id="cancelEditBtn">Cancel</button>
      <button type="submit" class="btn btn-primary">
        <i class="bi bi-check-circle"></i> Save Changes
      </button>
    </div>
  </form>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Toggle between view and edit profile modes
    const editProfileBtn = document.getElementById('editProfileBtn');
    const cancelEditBtn = document.getElementById('cancelEditBtn');
    const viewProfileSection = document.getElementById('viewProfileSection');
    const editProfileSection = document.getElementById('editProfileSection');
    
    if (editProfileBtn && cancelEditBtn) {
      editProfileBtn.addEventListener('click', function() {
        viewProfileSection.style.display = 'none';
        editProfileSection.style.display = 'block';
      });
      
      cancelEditBtn.addEventListener('click', function() {
        editProfileSection.style.display = 'none';
        viewProfileSection.style.display = 'block';
      });
    }
    
    // Handle website fields
    const addWebsiteBtn = document.getElementById('addWebsiteBtn');
    const websitesContainer = document.getElementById('websitesContainer');
    
    if (addWebsiteBtn && websitesContainer) {
      // Add new website field
      addWebsiteBtn.addEventListener('click', function() {
        const newWebsiteField = document.createElement('div');
        newWebsiteField.className = 'website-input-group';
        newWebsiteField.innerHTML = `
          <input type="text" class="form-control" name="website_name[]" placeholder="Website Name">
          <input type="url" class="form-control" name="website_url[]" placeholder="https://example.com">
          <button type="button" class="btn btn-danger remove-website">
            <i class="bi bi-trash"></i>
          </button>
        `;
        websitesContainer.appendChild(newWebsiteField);
      });
      
      // Remove website field
      websitesContainer.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-website') || e.target.parentElement.classList.contains('remove-website')) {
          const button = e.target.closest('.remove-website');
          const fieldGroup = button.closest('.website-input-group');
          
          if (websitesContainer.children.length > 1) {
            fieldGroup.remove();
          } else {
            // Clear the inputs if it's the last one
            const inputs = fieldGroup.querySelectorAll('input');
            inputs.forEach(input => input.value = '');
          }
        }
      });
    }
    
    // Handle qualification fields
    const addQualificationBtn = document.getElementById('addQualificationBtn');
    const qualificationsContainer = document.getElementById('qualificationsContainer');
    
    if (addQualificationBtn && qualificationsContainer) {
      // Add new qualification field
      addQualificationBtn.addEventListener('click', function() {
        const newQualificationField = document.createElement('div');
        newQualificationField.className = 'qualification-input-group';
        newQualificationField.innerHTML = `
          <div class="row">
            <div class="col-md-5 form-row">
              <input type="text" class="form-control" name="qualification_degree[]" placeholder="Degree/Qualification">
            </div>
            <div class="col-md-5 form-row">
              <input type="text" class="form-control" name="qualification_institution[]" placeholder="Institution">
            </div>
            <div class="col-md-2 form-row">
              <div class="input-group">
                <input type="number" class="form-control" name="qualification_year[]" placeholder="Year">
                <button type="button" class="btn btn-danger remove-qualification">
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </div>
          </div>
        `;
        qualificationsContainer.appendChild(newQualificationField);
      });
      
      // Remove qualification field
      qualificationsContainer.addEventListener('click', function(e) {
        if (e.target.classList.contains('remove-qualification') || e.target.parentElement.classList.contains('remove-qualification')) {
          const button = e.target.closest('.remove-qualification');
          const fieldGroup = button.closest('.qualification-input-group');
          
          if (qualificationsContainer.children.length > 1) {
            fieldGroup.remove();
          } else {
            // Clear the inputs if it's the last one
            const inputs = fieldGroup.querySelectorAll('input');
            inputs.forEach(input => input.value = '');
          }
        }
      });
    }
  });
</script>

<style>
  /* Profile-specific styles */
  .qualification-item {
    background-color: #f8f9fa;
    border-radius: 0.5rem;
    padding: 1rem;
    margin-bottom: 0.75rem;
    transition: all 0.3s ease;
  }
  
  .qualification-item:hover {
    background-color: #f1f3f5;
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  }
  
  .qualification-degree {
    font-weight: 600;
    color: #343a40;
    margin-bottom: 0.25rem;
  }
  
  .qualification-school {
    color: #495057;
    font-size: 0.925rem;
    margin-bottom: 0.25rem;
  }
  
  .qualification-year {
    color: #6c757d;
    font-size: 0.875rem;
  }
  
  .qualification-input-group {
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e9ecef;
  }
  
  .qualification-input-group:last-child {
    border-bottom: none;
  }
  
  .qualifications-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }
</style>
{% endblock %}